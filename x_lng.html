<!DOCTYPE html>
<html>
<head>
    <title>Telegram Explorer</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body style="color: aliceblue;">
    <div id="keysList"></div>
    <div id="add_lng">
        <input id="lng_input">
        <button id="lng_commit">Add</button>
    </div>

    <div id="keyse"></div>
    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let ese = document.getElementById('lng_commit').addEventListener('click', function(){
            tg.CloudStorage.setItem("lng-" + document.getElementById('lng_input').value, '', function(err) {
                if (err) {
                    console.log('error')
                } else {
                    essa()
                }
            });
        });

        function essa(){
        tg.CloudStorage.getKeys(function(err, keys) {
            if (err) {
                console.log('Ошибка получения ключей: ' + err);
            } else {
                let ke = keys.filter(word => word.includes(String('lng')))
                tg.CloudStorage.getItems(ke, function(err, items) {
                    if (err) {
                        console.log('Ошибка получения значений: ' + err);
                    } else {
                        let kese = document.getElementById('keyse')
                        kese.innerHTML = '';
                        Object.keys(items).forEach(function(key) {
                            var head = document.createElement('div');
                            var name = document.createElement('p');
                            var inp = document.createElement('textarea');
                            var btn = document.createElement('button');

                            inp.value = items[key]
                            let yy = items[key].split('\n')
                            yy.forEach(ee => {
                                let yd = ee.split(':')
                                console.log(yd)
                            })

                            inp.addEventListener('input', function(event){
                                var textarea = event.target;
                                textarea.style.height = "auto";
                                var newHeight = textarea.scrollHeight;
                                textarea.style.height = newHeight + "px";
                            })

                            name.innerHTML = String(key);
                            head.id = String(key) + '-head';     
                            inp.id = String(key) + '-tgs';
                            inp.classList.add('addb');
                            btn.id = String(key);
                            btn.innerHTML = "Refresh";

                            btn.addEventListener('click', function(event) {
                                let buttonId = event.target.id;
                                let inpP = document.getElementById(buttonId+'-tgs')

                                tg.CloudStorage.setItem(buttonId, inpP.value, function(err) {
                                    if (err) {
                                        console.log('error')
                                    } else {
                                        essa()
                                    }
                                });
                                
                            });

                            head.appendChild(name);
                            head.appendChild(inp);
                            head.appendChild(btn);
                            kese.appendChild(head);
                        });
                    }
                })
            }
        });
        }
        essa()
    </script>

</body>
</html>
