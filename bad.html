<!DOCTYPE html>
<html>
<head>
    <title>Telegram Explorer</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <h2 id="opa"></h2>
    <h2 id="pa"></h2>
    <div id="log"></div>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var idi = getParameterByName('ids');

    </script>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        let ke = idi.split('.')
        tg.CloudStorage.getKeys(function(err, keys) {
        if (err) {
            document.getElementById('opa').innerHTML = 'Ошибка получения ключей:' + err;
        } else {
            let bb = document.getElementById('log');
            keys.forEach(function(key) {
            var splittedKey = key.split('-');
            if (splittedKey.length >= 2){
                if (ke.indexOf(String(splittedKey[1])) !== -1) {
                tg.CloudStorage.removeItem(key, function(err2) {
                let ab = document.createElement('div');
                if (err2) {
                    ab.innerHTML += 'Ошибка удаления ключа:' + err2;
                } else {
                    ab.innerHTML += 'Ключ успешно удален:' + key;
                }
                bb.appendChild(ab);
                });
                }
            }
            });
            
        }
        });


       // let tg = window.Telegram.WebApp;
       // tg.expand();

      //  tg.CloudStorage.getKeys(function(err, keys) {
       // if (err) {
        //    document.getElementById('opa').innerHTML = 'Ошибка получения ключей:' + err;
       // } else {
        //    document.getElementById('opa').innerHTML = 'Список ключей:' + JSON.stringify(keys);
       // }
       // });
        

    </script>

</body>
</html>
